#!/bin/bash

build () {
    local mod=$1
    if [ -z "$mod" ]; then
        echo module name required
    fi
    docker build --no-cache $mod -t greentranslator/green-$mod
}
push () {
    local mod=$1
    if [ -z "$mod" ]; then
        echo module name required
    fi
    docker push greentranslator/green-$mod
}
clean () {
    images () {
        for i in $(sudo docker images | awk '{ print $3 }' | grep -vi image); do echo $i; sudo docker rmi -f $i; done
    }
    $*
}
all () {
    build base
    push base
    build onto
    push onto
    build bionames
    push bionames
}

all_bionames () {
    build base
    push base
    build bionames
    push bionames
}

all_onto () {
    build base
    push base
    build onto
    push onto
}

all_uberonto () {
    build base
    push base
    build uberonto
    push uberonto
}

all_onto_gunicorn () {
    build base
    push base
    build onto_gunicorn
    push onto_gunicorn
}

all_uberonto_gunicorn () {
    build base
    push base
    build uberonto_gunicorn
    push uberonto_gunicorn
}

all_bionames_gunicorn () {
    build base
    push base
    build bionames_gunicorn
    push bionames_gunicorn
}

kill () {
    local mod=$1
    if [ -z "$mod" ]; then
        echo module name required
    fi
    docker kill -s 9 $mod
}
shell () {
        local mod=$1
    if [ -z "$mod" ]; then
        echo module name required
    fi
    docker exec -it $mod bash
}
monit () {
    set -x
    docker run \
           --name monit \
           --rm \
           greentranslator/green-monit-base $*
    set +x
}
tranql () {
    set -x
    docker run \
           --name tranql \
           --rm \
           --publish=8101:8101 \
           greentranslator/green-tranql
    set +x
}
onto () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name ont \
           --rm \
           --publish=5001:5353 \
           -v ${local_dir}:/data greentranslator/green-onto
    set +x
}
onto_gunicorn () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name ont \
           --rm \
           --publish=5001:5359 \
           -v ${local_dir}:/data greentranslator/green-onto-gunicorn
    set +x
}
uberonto () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name ont \
           --rm \
           --publish=5001:5355 \
           -v ${local_dir}:/data greentranslator/green-uberonto
    set +x
}
uberonto_gunicorn () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name ont \
           --rm \
           --publish=5001:5357 \
           -v ${local_dir}:/data greentranslator/green-uberonto-gunicorn
    set +x
}
bionames () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name bio \
           --rm \
           --publish=5001:5354 \
           -v ${local_dir}:/data greentranslator/green-bionames
    set +x
}
bionames_gunicorn () {
    set -x
    local_dir=$1
    docker run \
           --env GIT_PULL=true \
           --name bio \
           --rm \
           --publish=5001:5358 \
           -v ${local_dir}:/data greentranslator/green-bionames-gunicorn
    set +x
}

$*
